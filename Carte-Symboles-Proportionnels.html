<!DOCTYPE html>
<html style="font-size: 16px;">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <meta name="keywords" content="INTUITIVE">
    <meta name="description" content="">
    <meta name="page_type" content="np-template-header-footer-from-plugin">
    <title>DigiEducation - Symboles proportionnels</title>
    <link rel="icon" type="image/png" href="images/LOGO.png" />
    <link rel="stylesheet" href="nicepage.css" media="screen">
<link rel="stylesheet" href="Carte-Symboles-Proportionnels.css" media="screen">
    <script class="u-script" type="text/javascript" src="jquery.js" defer=""></script>
    <script class="u-script" type="text/javascript" src="nicepage.js" defer=""></script>
    <meta name="generator" content="Nicepage 4.5.4, nicepage.com">
    <link id="u-theme-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i|Open+Sans:300,300i,400,400i,500,500i,600,600i,700,700i,800,800i">
    
    
    
    <script type="application/ld+json">{
		"@context": "http://schema.org",
		"@type": "Organization",
		"name": ""
}</script>
    <meta name="theme-color" content="#478ac9">
    <meta property="og:title" content="Carte Symboles Proportionnels">
    <meta property="og:type" content="website">
  </head>
  <body class="u-body u-xl-mode"><header class="u-clearfix u-header u-palette-1-dark-1 u-header" id="sec-aa95"><div class="u-clearfix u-sheet u-sheet-1"><span class="u-file-icon u-icon u-icon-1"><img src="images/2987867.png" alt=""></span>
        <nav class="u-menu u-menu-dropdown u-offcanvas u-menu-1">
          <div class="menu-collapse" style="font-size: 1rem; letter-spacing: 0px;">
            <a class="u-button-style u-custom-left-right-menu-spacing u-custom-padding-bottom u-custom-text-active-color u-custom-top-bottom-menu-spacing u-nav-link u-text-active-palette-1-base u-text-hover-palette-2-base" href="#">
              <svg class="u-svg-link" viewBox="0 0 24 24"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#menu-hamburger"></use></svg>
              <svg class="u-svg-content" version="1.1" id="menu-hamburger" viewBox="0 0 16 16" x="0px" y="0px" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg"><g><rect y="1" width="16" height="2"></rect><rect y="7" width="16" height="2"></rect><rect y="13" width="16" height="2"></rect>
</g></svg>
            </a>
          </div>
          <div class="u-custom-menu u-nav-container">
            <ul class="u-nav u-unstyled u-nav-1"><li class="u-nav-item"><a class="u-button-style u-nav-link u-text-active-palette-3-base u-text-hover-palette-2-base" href="Accueil.html" style="padding: 10px 20px;">Accueil</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link u-text-active-palette-3-base u-text-hover-palette-2-base" href="Carte-Choroplèthe.html" style="padding: 10px 20px;">Carte Choroplèthe</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link u-text-active-palette-3-base u-text-hover-palette-2-base" href="Carte-Symboles-Proportionnels.html" style="padding: 10px 20px;">Carte Symboles Proportionnels</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link u-text-active-palette-3-base u-text-hover-palette-2-base" href="Contact.html" style="padding: 10px 20px;">Contact</a>
</li></ul>
          </div>
          <div class="u-custom-menu u-nav-container-collapse">
            <div class="u-black u-container-style u-inner-container-layout u-opacity u-opacity-95 u-sidenav">
              <div class="u-inner-container-layout u-sidenav-overflow">
                <div class="u-menu-close"></div>
                <ul class="u-align-center u-nav u-popupmenu-items u-unstyled u-nav-2"><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Accueil.html" style="padding: 10px 20px;">Accueil</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Carte-Choroplèthe.html" style="padding: 10px 20px;">Carte Choroplèthe</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Carte-Symboles-Proportionnels.html" style="padding: 10px 20px;">Carte Symboles Proportionnels</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Contact.html" style="padding: 10px 20px;">Contact</a>
</li></ul>
              </div>
            </div>
            <div class="u-black u-menu-overlay u-opacity u-opacity-70"></div>
          </div>
        </nav>
        <h4 class="u-text u-text-default u-text-white u-text-1">DigiEducation</h4>
      </div></header>
    <section class="u-clearfix u-section-1" id="sec-d697">
      <div class="u-clearfix u-sheet u-sheet-1">
        <h1 class="u-align-center u-text u-text-default u-text-palette-5-dark-2 u-title u-text-1">Carte Symboles Proportionnels</h1>
        <h4 class="u-align-center u-text u-text-2">
          <span class="u-text-palette-2-dark-1">Nombre d'étudiants</span> poursuivant leurs études aux établissements d'enseignement supérieur (universités + établissement ne relevant pas des universités) <span class="u-text-palette-2-dark-1">par région</span>
        </h4>
      </div>
    </section>
    <section class="u-clearfix u-section-2" id="sec-c4ba">
      <div class="u-clearfix u-sheet u-sheet-1">
        <html>
          <head>

              <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
              integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
              crossorigin=""/>
              <link rel="stylesheet" href="css/style1.css">
              <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
              integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
              crossorigin=""></script>

              <script src="https://code.jquery.com/jquery-3.5.1.min.js"
              integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
              crossorigin="anonymous"></script>

              <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
              integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="
              crossorigin="anonymous"></script>

              <style type="text/css">
                html, body { margin: 0px; padding: 1; height: 100%; }
                #map  {
                        width: 800px;
                        height: 580px;
                        margin: 15px auto
                      }
                
              </style>

          </head>

          <body>

              <div id="map"></div>
              <script type="text/javascript" src="regions.js"></script>
              <script type="text/javascript">
              $(document).ready(function() {
                var map = L.map('map', {
                    center: [29, -5],
                    zoom: 5
                });
              
                L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png', {
                 attribution: 'Map tiles by Carto, under CC BY 3.0. Data by OpenStreetMap, under ODbL.',
                 maxZoom: 11,
                 minZoom: 4
               }).addTo(map);
                
                function Monstyle(feature) {
                  return {
                    weight: 2,
                    opacity: 1,
                    color: '#5a5e5f',
                    dashArray: '3',
                    fillOpacity: 0.8,
                    fillColor: '#b3bcbe'
                  };
                } 
                
                var geojson = L.geoJson(regions, {
                  style: Monstyle}).addTo(map);

               //Upload Geojson File
               
            $.getJSON("https://raw.githubusercontent.com/nadaelhaouss/nada/main/etu.geojson")
            .done(function(data) {
                var info = processData(data);
                createPropSymbols(info.timestamps, data);
                createLegend(info.min,info.max);
                createSliderUI(info.timestamps);
                
            });

              // Process Data
              function processData(data) {
                
                var timestamps = [];  
                var min = Infinity; 
                var max = -Infinity;

                
                for (var feature in data.features) {
                    var properties = data.features[feature].properties;

                    
                    for (var attribute in properties) {
                        if ( attribute != 'FID_' &&
                             attribute != 'Id' &&
                             attribute != 'Nom' &&
                             attribute != 'Lat' &&
                             attribute != 'Lon' )   
                        {
                            if ( $.inArray(attribute,timestamps) ===  -1) { 
                                                              

                                timestamps.push(attribute);  
                            }
                            if (properties[attribute] < min) {
                                min = properties[attribute]; 
                            }
                            if (properties[attribute] > max) {
                                max = properties[attribute]; 
                            }
                        }
                    }
                }
                return { 
                    timestamps : timestamps,
                    min : min,
                    max : max
                }
              }

              // Create Propotional Symbols
              function createPropSymbols(timestamps, data) {

                regions = L.geoJson(data, {

                    
                    pointToLayer: function(feature, latlng) {
                        return L.circleMarker(latlng, { // we use circle marker for the points
                            fillColor: '#4682b4',  // fill color of the circles
                            color: '#03173b',      // border color of the circles
                            weight: 3,             // circle line weight in pixels
                            fillOpacity: 0.5       // fill opacity (0-1)
                        }).on({
                              mouseover: function(e) {
                                  this.openPopup();
                                  this.setStyle({fillColor: 'black'});  // fill color turns black when mouseover
                              },
                              mouseout: function(e) {
                                  this.closePopup();
                                  this.setStyle({fillColor: '#4682b4'});  // fill turns original color when mouseout
                              }
                      });
                    }
                }).addTo(map);

                updatePropSymbols(timestamps[0]); 
              }

              // Update Propotional Symbols
              function updatePropSymbols(timestamp) {

                regions.eachLayer(function(layer) {  

                    var props = layer.feature.properties;  
                    var radius = calcPropRadius(props[timestamp]); 

                    
                    var popupContent = '<b> Région : <b>' + props.Nom + '</b> <br />Total des étudiants : ' + String(props[timestamp]) ;

                    layer.setRadius(radius);  
                    layer.bindPopup(popupContent, { offset: new L.Point(0,-radius), autoPan: false }); 
                });
              }

              
              function calcPropRadius(attributeValue) {

                var scaleFactor = 0.008;   
                var area = attributeValue * scaleFactor;

                return Math.sqrt(area/Math.PI);  
              }


              function createLegend(min, max) {
                      if (min < 20000) { 
                          min = 20000; 
                      }
                      if (max > 100000) { 
                          max = 200000;     
                      }
                      function roundNumber(inNumber) {
                           return (Math.round(inNumber/10) * 10);
                      }
                      var legend = L.control( { position: 'bottomright'} );    
                      legend.onAdd = function(map) {

                      var legendContainer = L.DomUtil.create("div", "legend");
                      var symbolsContainer = L.DomUtil.create("div", "symbolsContainer");
                      var classes = [roundNumber(min), roundNumber((max-min)/2), roundNumber(max)]; 
                      var legendCircle;
                      var lastRadius = 0;
                      var currentRadius;
                      var margin;
                      L.DomEvent.disableClickPropagation(legendContainer);; 
                      $(legendContainer).append("<h3 id='legendTitle'>Nombre d'étudiants par Région</h3>");

                      for (var i = 0; i <= classes.length-1; i++) {

                          legendCircle = L.DomUtil.create("div", "legendCircle");
                          currentRadius = calcPropRadius(classes[i]);
                          margin = -currentRadius - lastRadius - 2;
                          $(legendCircle).attr("style", "width: " + currentRadius*2 +
                              "px; height: " + currentRadius*2 + 
                              "px; margin-left: " + margin + "px" );
                          $(legendCircle).append("<span       class='legendValue'>"+ classes[i] + '   '+ 'étudiants' +"</span>");
                          $(symbolsContainer).append(legendCircle);
                          lastRadius = currentRadius;
                      }
                      $(legendContainer).append(symbolsContainer);
                      return legendContainer; 
                      };
                      legend.addTo(map);} // end createLegend() 



          // Creation of the Slider
          function createSliderUI(timestamps) {
            var sliderControl = L.control({ position: 'bottomleft'} ); 
            sliderControl.onAdd = function(map) {
              
                var slider = L.DomUtil.create("input", "range-slider");
                L.DomEvent.addListener(slider, 'mousedown', function(e) {
                    L.DomEvent.stopPropagation(e);
                });

              var labels = ["2018/2019", "2019/2020","2020/2021","2021/2022"];

              $(slider)
                  .attr({
                    'type':'range',
                    'max': timestamps[timestamps.length-1],
                    'min':timestamps[0],
                    'step': 1, 
                    'value': String(timestamps[0])})
                  .on('input change', function() {
                      updatePropSymbols($(this).val().toString()); 
                      var i = $.inArray(this.value,timestamps);
                      $(".temporal-legend").text(labels[i]); 
                  });
              return slider;
            }
            sliderControl.addTo(map);
            createTimeLabel("2018/2019"); 
            }

            // Create a Legend for the Slider

            function createTimeLabel(startTimestamp) {
              var temporalLegend = L.control({position: 'bottomleft' }); 
              temporalLegend.onAdd = function(map) {
                var output = L.DomUtil.create("output", "temporal-legend");
                $(output).text(startTimestamp);
                return output;
              }
              temporalLegend.addTo(map);
            }




          });

              </script>
          </body>
        </html>
      </div>
    </section>
    
    
    <footer class="u-align-center u-clearfix u-footer u-grey-80 u-footer" id="sec-42b7"><div class="u-clearfix u-sheet u-valign-middle u-sheet-1">
        <p class="u-small-text u-text u-text-variant u-text-1"> PROJET WEB-MAPPING 2022</p>
      </div></footer>
  </body>
</html>